<div [ngClass]="!isFirstTime? '': 'invisible'" class="animated fadeIn" id="container"
  style="width: 100%; height: 87vh;">
  <button id="mapfullScreenControl" *ngIf="showFullScreenControle" title="Enter FullScreen"
    class="control-fullscreen-button" (click)="toggleMapFullscreen()"></button>
  <button id="positionControl" *ngIf="showPositionControle" title="My Postion"
    class="control-position-button icon-target" (click)="toggleMyPosition()"></button>
  <button id="clusterConrtol" *ngIf="showClusterControle" title="Toggle Clustering" class="mcontrol cil-vector"
    (click)="toggleClustering()"></button>
  <button id="resetConrtol" title="Default View" class="control-position-button icon-close text-danger"
    [ngClass]="selectedVehiculeIndex==-1 ? 'd-none':''" (click)="reset()"></button>
  <button *ngIf="showCollapsControle" title="Expande list" class="mcontrol icon-arrow-right" id="list-Expand"
    (click)="expandClicked()"></button>
  <as-split #mySplit direction="horizontal" [useTransition]="true" (gutterClick)="resetSize()"
    (dragEnd)="onDragEnd($event)" (transitionEnd)="invalidate()">
    <as-split-area [size]="size[0]" [order]="1" style="overflow: hidden;">
      <div class="list-vehicules">
        <my-table [vehicules]="vehicules" (rowClicked)="rowClicked($event)" (shareClicked)="shareClicked($event)"
          (showReportClicked)="showReportClicked($event)" (collapse)="collapseClicked()"></my-table>
      </div>
    </as-split-area>
    <as-split-area [size]="size[1]" [order]="2">
      <as-split #mySplit2 direction="vertical" [disabled]="splitDisabled" [useTransition]="true"
        (gutterClick)="resetSize2()" (transitionEnd)="invalidate()">
        <as-split-area [size]="size2[0]" [order]="1">
          <div class="my-map">
            <div class="card-body" id="map" overlay="true"></div>
          </div>
        </as-split-area>
        <as-split-area [size]="size2[1]" [visible]="!splitDisabled" [order]="2" [maxSize]="maxSize"
          style="background-color: white;">
          <div class="mt-auto">
            <div class="col-12 p-auto py-1 bg-secondary" style="margin-bottom: -26px;">
              <div class="col-4 m-auto row"><button class="col-3 btn btn-primary p-0"
                  (click)="incrementDate(-1)">&lt;&lt;</button>
                <div class="col-6"><input type="date" [(ngModel)]="selectedDateString" (ngModelChange)="updateCalcs()"
                    [ngModelOptions]="{standalone: true}" class="form-control p-0 px-1" style="height: auto;"></div>
                <button class="col-3 btn btn-primary p-0" (click)="incrementDate(1)">&gt;&gt;</button>
              </div>
            </div>
            <div class="px-2 py-1 h5 float-left text-primary" style="position: relative;top: -5px;">{{selectedVName}}</div>
            <div class="btn btn-close bg-danger float-right" style="top: -5px;position: relative;right: 1px;"
              (click)="closeSpliter(true)">X</div>
            <div class="row mx-auto px-4 w-100 justify-content-center">
              <div class="col-2 col-md-2">
                <div class="card mb-1">
                  <div class="card-header bg-green text-uppercase text-white text-center p-1">
                    <div class="h6 m-0">Duree En Route</div>
                  </div>
                  <div class="card-body text-center p-1"><i
                      class="nav-icon icon-speedometer h6 text-green">&nbsp;{{resume.dureeMoving}}</i></div>
                </div>
              </div>
              <div class="col-2 col-md-2">
                <div class="card mb-1">
                  <div class="card-header bg-warning text-uppercase text-white text-center p-1">
                    <div class="h6 m-0">Duree Moteur ON</div>
                  </div>
                  <div class="card-body text-center p-1"><i
                      class="nav-icon icon-speedometer h6 text-warning">&nbsp;{{resume.dureeON}}</i></div>
                </div>
              </div>
              <div class="col-2 col-md-2">
                <div class="card mb-1">
                  <div class="card-header bg-red text-uppercase text-white text-center p-1">
                    <div class="h6 m-0">Duree Moteur OFF</div>
                  </div>
                  <div class="card-body text-center p-1"><i
                      class="nav-icon icon-speedometer h6 text-red">&nbsp;{{resume.dureeOFF}}</i></div>
                </div>
              </div>
            </div>

            <div class="row mx-auto px-4 w-100 justify-content-center">
              <div class="col-2 col-md-2">
                <div class="card mb-1">
                  <div class="card-header bg-primary text-uppercase text-white text-center p-1">
                    <div class="h6 m-0">Odometre</div>
                  </div>
                  <div class="card-body text-center p-1"><i
                      class="nav-icon icon-speedometer h6 text-primary">&nbsp;{{resume.odometer}} KM</i></div>
                </div>
              </div>
              <div class="col-2 col-md-2">
                <div class="card mb-1">
                  <div class="card-header bg-primary text-uppercase text-white text-center p-1">
                    <div class="h6 m-0">Kilométrage parcouru</div>
                  </div>
                  <div class="card-body text-center p-1"><i
                      class="nav-icon icon-graph h6 text-primary">&nbsp;{{resume.kmParcoure}} KM</i></div>
                </div>
              </div>
              <div class="col-2 col-md-2">
                <div class="card mb-1">
                  <div class="card-header bg-blue text-uppercase text-white text-center p-1">
                    <div class="h6 m-0">Vitesse Max</div>
                  </div>
                  <div class="card-body text-center p-1"><i
                      class="fa fa-tachometer h6 m-0 text-blue">&nbsp;{{resume.maxVitesse}} KM/H</i></div>
                </div>
              </div>
              <div class="col-2 col-md-2">
                <div class="card mb-1">
                  <div class="card-header bg-info text-uppercase text-white text-center p-1">
                    <div class="h6 m-0">Carburant</div>
                  </div>
                  <div class="card-body text-center p-1"><i
                      class="fa fa-battery-quarter h6 m-0 text-blue">&nbsp;{{resume.fuelLevel}} L</i></div>
                </div>
              </div>
              <div class="col-2 col-md-2">
                <div class="card mb-1">
                  <div class="card-header bg-info text-uppercase text-white text-center p-1">
                    <div class="h6 m-0">consommation</div>
                  </div>
                  <div class="card-body text-center p-1"><i
                      class="fa fa-battery-quarter h6 m-0 text-blue">&nbsp;{{resume.consomation}} L</i></div>
                </div>
              </div>
              <div class="col-2 col-md-2">
                <div class="card mb-1">
                  <div class="card-header bg-info text-uppercase text-white text-center p-1">
                    <div class="h6 m-0">consom moyenne</div>
                  </div>
                  <div class="card-body text-center p-1"><i
                      class="fa fa-battery-quarter h6 m-0 text-blue">&nbsp;{{resume.consomationMoyenne}} %</i></div>
                </div>
              </div>
            </div>
            <div class="btn btn-outline-primary w-100 border-bottom-0" title="Afficher le trajet du jour" (click)="showAllTrajet()"><i
                class="nav-icon cil-map"></i> Afficher le trajet complet</div>
            <div class="chart-wrapper" style="background: #fff9f0;">
              <ng-template #popTemplate let-view="view">
                <div style="width:375px" [innerHtml]="segmentedData[view].tooltip"></div>
              </ng-template>
              <div class="vis-content">
                <div class="vis-itemset">
                  <div class="vis-group">
                    <div id="event-{{i}}" *ngFor="let event of segmentedData;let i=index;"
                      (click)="chartClicked(i)" container="event-{{i}}"
                      containerClass="tooltipContainer-{{segmentedData[i].status}}" [ngClass]="event.class"
                      [style.width]="event.ratio" [popover]="popTemplate" boundariesElement="window"
                      [outsideClick]="true" triggers="mouseenter:mouseleave" [popoverContext]="{ view: i }"></div>
                  </div>
                </div>
                <div class="xAxisContainer">
                  <div class="xAxis">
                    <div class="xAxisTick">
                      <div class="tick"></div>
                      <div class="xLabel">00H</div>
                    </div>
                    <div class="xAxisTick">
                      <div class="tick"></div>
                      <div class="xLabel">02H</div>
                    </div>
                    <div class="xAxisTick">
                      <div class="tick"></div>
                      <div class="xLabel">04H</div>
                    </div>
                    <div class="xAxisTick">
                      <div class="tick"></div>
                      <div class="xLabel">06H</div>
                    </div>
                    <div class="xAxisTick">
                      <div class="tick"></div>
                      <div class="xLabel">08H</div>
                    </div>
                    <div class="xAxisTick">
                      <div class="tick"></div>
                      <div class="xLabel">10H</div>
                    </div>
                    <div class="xAxisTick">
                      <div class="tick"></div>
                      <div class="xLabel">12H</div>
                    </div>
                    <div class="xAxisTick">
                      <div class="tick"></div>
                      <div class="xLabel">14H</div>
                    </div>
                    <div class="xAxisTick">
                      <div class="tick"></div>
                      <div class="xLabel">16H</div>
                    </div>
                    <div class="xAxisTick">
                      <div class="tick"></div>
                      <div class="xLabel">18H</div>
                    </div>
                    <div class="xAxisTick">
                      <div class="tick"></div>
                      <div class="xLabel">20H</div>
                    </div>
                    <div class="xAxisTick">
                      <div class="tick"></div>
                      <div class="xLabel">22H</div>
                    </div>
                    <div style="width: 0%;">
                      <div class="tick"></div>
                      <div class="xLabel" style="display: flex;">24H</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </as-split-area>
      </as-split>
    </as-split-area>
  </as-split>
</div>
<img src="assets/gif/loading.gif" alt="Loading" *ngIf="isFirstTime" class="loadinger" />

<div bsModal #secondModal="bs-modal" [config]="{backdrop: 'static', keyboard: false}" class="modal fade" tabindex="-1"
  role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-primary row justify-content-center" role="document">
    <div class="modal-content col-md-4 p-0">
      <div class="modal-header">
        <h5 class="modal-title"> Partager le Suivi de Vehicule: {{getVehicleName(vehicle2shareIndex)}}</h5>
        <button type="button" class="close" (click)="secondModal.hide()" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <form>
        <div class="modal-body p-0">
          <mat-progress-bar mode="indeterminate" *ngIf="modalLoading"></mat-progress-bar>
          <div class="animated fadeIn">
            <div class="row">
              <div class="col">
                <div class="card-body">
                  <label for="sw1" class="ml-2">Partager le trajet&nbsp;</label><input
                    class="form-check-input switch mx-2 mb-4 " type="checkbox" id="sw1" [(ngModel)]="isShareTrajet"
                    [ngModelOptions]="{standalone: true}">
                  <mat-form-field class="w-100" appearance="fill">
                    <mat-label>Durée (en minutes)</mat-label>
                    <input type="number" aria-label="Number" min="1" max="20000000" matInput [matAutocomplete]="auto"
                      [(ngModel)]="period" [ngModelOptions]="{standalone: true}">
                    <mat-autocomplete #auto="matAutocomplete">
                      <mat-option *ngFor="let option of periodOptions" [value]="option.val">
                        {{option.name}}
                      </mat-option>
                    </mat-autocomplete>
                  </mat-form-field>
                  <!-- <input type="text" class="w-100" disabled [(ngModel)]="generatedShareLink"
                    [ngModelOptions]="{standalone: true}"> -->
                  <div class="input-group mb-4">
                    <input class="form-control" id="generatedShareLink" [(ngModel)]="generatedShareLink"
                      [ngModelOptions]="{standalone: true}">
                    <div class="input-group-append" style="cursor: pointer;" title="Copier"
                      onclick="document.querySelector('#generatedShareLink').select();document.execCommand('copy');">
                      <span class="input-group-text"><i class="fa fa-copy"></i></span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </form>
      <div class="modal-footer" style="justify-content: left;display: initial;">
        <mat-hint class="text-danger">{{errorMsg}}</mat-hint>
        <button type="button" class="btn btn-primary float-right" (click)="generateShareLink()">Générer</button>
        <button type="button" class="btn btn-secondary float-right" (click)="secondModal.hide()">Fermer</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<app-modal #modalRoot [maximizable]="true" [inViewport]="true" (onDragOrResizeModal)="invalidateModalMap()"
  (closeModal)="onCloseModal()">
  <ng-container class="app-modal-header">{{selectedVName}}<div class="float-right">
      <label for="s1111" class="ml-2 float-right">Afficher tous les points &nbsp;</label>
      <input id="s1111" type="checkbox" style="margin-top: 4px;" class="switch float-right" [(ngModel)]="showAllPoints"
        [ngModelOptions]="{standalone: true}" (ngModelChange)="showAllPointscheckbox()">
    </div>
  </ng-container>
  <ng-container class="app-modal-body">
    <div class="my-map">
      <div id="mapModal" overlay="true"></div>
    </div>
  </ng-container>
</app-modal>